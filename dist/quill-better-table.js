!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("quill")):"function"==typeof define&&define.amd?define(["quill"],t):"object"==typeof exports?exports.quillBetterTable=t(require("quill")):e.quillBetterTable=t(e.Quill)}(window,function(e){return function(e){var t=window.webpackHotUpdatequillBetterTable;window.webpackHotUpdatequillBetterTable=function(e,n){!function(e,t){if(!C[e]||!x[e])return;for(var n in x[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(b[n]=t[n]);0==--g&&0===y&&q()}(e,n),t&&t(e,n)};var n,o=!0,r="0669b40ee22f22cb9299",l=1e4,i={},s=[],a=[];function d(e){var t=S[e];if(!t)return R;var o=function(o){return t.hot.active?(S[o]?-1===S[o].parents.indexOf(e)&&S[o].parents.push(e):(s=[e],n=o),-1===t.children.indexOf(o)&&t.children.push(o)):(console.warn("[HMR] unexpected require("+o+") from disposed module "+e),s=[]),R(o)},r=function(e){return{configurable:!0,enumerable:!0,get:function(){return R[e]},set:function(t){R[e]=t}}};for(var l in R)Object.prototype.hasOwnProperty.call(R,l)&&"e"!==l&&"t"!==l&&Object.defineProperty(o,l,r(l));return o.e=function(e){return"ready"===h&&p("prepare"),y++,R.e(e).then(t,function(e){throw t(),e});function t(){y--,"prepare"===h&&(w[e]||T(e),0===y&&0===g&&q())}},o.t=function(e,t){return 1&t&&(e=o(e)),R.t(e,-2&t)},o}function c(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var o=0;o<e.length;o++)t._acceptedDependencies[e[o]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:N,apply:E,status:function(e){if(!e)return h;u.push(e)},addStatusHandler:function(e){u.push(e)},removeStatusHandler:function(e){var t=u.indexOf(e);t>=0&&u.splice(t,1)},data:i[e]};return n=void 0,t}var u=[],h="idle";function p(e){h=e;for(var t=0;t<u.length;t++)u[t].call(null,e)}var f,b,m,g=0,y=0,w={},x={},C={};function v(e){return+e+""===e?+e:e}function N(e){if("idle"!==h)throw new Error("check() is only allowed in idle status");return o=e,p("check"),(t=l,t=t||1e4,new Promise(function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var o=new XMLHttpRequest,l=R.p+""+r+".hot-update.json";o.open("GET",l,!0),o.timeout=t,o.send(null)}catch(e){return n(e)}o.onreadystatechange=function(){if(4===o.readyState)if(0===o.status)n(new Error("Manifest request to "+l+" timed out."));else if(404===o.status)e();else if(200!==o.status&&304!==o.status)n(new Error("Manifest request to "+l+" failed."));else{try{var t=JSON.parse(o.responseText)}catch(e){return void n(e)}e(t)}}})).then(function(e){if(!e)return p("idle"),null;x={},w={},C=e.c,m=e.h,p("prepare");var t=new Promise(function(e,t){f={resolve:e,reject:t}});b={};return T(2),"prepare"===h&&0===y&&0===g&&q(),t});var t}function T(e){C[e]?(x[e]=!0,g++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=R.p+""+e+"."+r+".hot-update.js",document.head.appendChild(t)}(e)):w[e]=!0}function q(){p("ready");var e=f;if(f=null,e)if(o)Promise.resolve().then(function(){return E(o)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in b)Object.prototype.hasOwnProperty.call(b,n)&&t.push(v(n));e.resolve(t)}}function E(t){if("ready"!==h)throw new Error("apply() is only allowed in ready status");var n,o,l,a,d;function c(e){for(var t=[e],n={},o=t.slice().map(function(e){return{chain:[e],id:e}});o.length>0;){var r=o.pop(),l=r.id,i=r.chain;if((a=S[l])&&!a.hot._selfAccepted){if(a.hot._selfDeclined)return{type:"self-declined",chain:i,moduleId:l};if(a.hot._main)return{type:"unaccepted",chain:i,moduleId:l};for(var s=0;s<a.parents.length;s++){var d=a.parents[s],c=S[d];if(c){if(c.hot._declinedDependencies[l])return{type:"declined",chain:i.concat([d]),moduleId:l,parentId:d};-1===t.indexOf(d)&&(c.hot._acceptedDependencies[l]?(n[d]||(n[d]=[]),u(n[d],[l])):(delete n[d],t.push(d),o.push({chain:i.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];-1===e.indexOf(o)&&e.push(o)}}t=t||{};var f={},g=[],y={},w=function(){console.warn("[HMR] unexpected require("+N.moduleId+") to disposed module")};for(var x in b)if(Object.prototype.hasOwnProperty.call(b,x)){var N;d=v(x);var T=!1,q=!1,E=!1,O="";switch((N=b[x]?c(d):{type:"disposed",moduleId:x}).chain&&(O="\nUpdate propagation: "+N.chain.join(" -> ")),N.type){case"self-declined":t.onDeclined&&t.onDeclined(N),t.ignoreDeclined||(T=new Error("Aborted because of self decline: "+N.moduleId+O));break;case"declined":t.onDeclined&&t.onDeclined(N),t.ignoreDeclined||(T=new Error("Aborted because of declined dependency: "+N.moduleId+" in "+N.parentId+O));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(N),t.ignoreUnaccepted||(T=new Error("Aborted because "+d+" is not accepted"+O));break;case"accepted":t.onAccepted&&t.onAccepted(N),q=!0;break;case"disposed":t.onDisposed&&t.onDisposed(N),E=!0;break;default:throw new Error("Unexception type "+N.type)}if(T)return p("abort"),Promise.reject(T);if(q)for(d in y[d]=b[d],u(g,N.outdatedModules),N.outdatedDependencies)Object.prototype.hasOwnProperty.call(N.outdatedDependencies,d)&&(f[d]||(f[d]=[]),u(f[d],N.outdatedDependencies[d]));E&&(u(g,[N.moduleId]),y[d]=w)}var A,B=[];for(o=0;o<g.length;o++)d=g[o],S[d]&&S[d].hot._selfAccepted&&B.push({module:d,errorHandler:S[d].hot._selfAccepted});p("dispose"),Object.keys(C).forEach(function(e){!1===C[e]&&function(e){delete installedChunks[e]}(e)});for(var L,M,I=g.slice();I.length>0;)if(d=I.pop(),a=S[d]){var _={},D=a.hot._disposeHandlers;for(l=0;l<D.length;l++)(n=D[l])(_);for(i[d]=_,a.hot.active=!1,delete S[d],delete f[d],l=0;l<a.children.length;l++){var $=S[a.children[l]];$&&((A=$.parents.indexOf(d))>=0&&$.parents.splice(A,1))}}for(d in f)if(Object.prototype.hasOwnProperty.call(f,d)&&(a=S[d]))for(M=f[d],l=0;l<M.length;l++)L=M[l],(A=a.children.indexOf(L))>=0&&a.children.splice(A,1);for(d in p("apply"),r=m,y)Object.prototype.hasOwnProperty.call(y,d)&&(e[d]=y[d]);var j=null;for(d in f)if(Object.prototype.hasOwnProperty.call(f,d)&&(a=S[d])){M=f[d];var k=[];for(o=0;o<M.length;o++)if(L=M[o],n=a.hot._acceptedDependencies[L]){if(-1!==k.indexOf(n))continue;k.push(n)}for(o=0;o<k.length;o++){n=k[o];try{n(M)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:d,dependencyId:M[o],error:e}),t.ignoreErrored||j||(j=e)}}}for(o=0;o<B.length;o++){var H=B[o];d=H.module,s=[d];try{R(d)}catch(e){if("function"==typeof H.errorHandler)try{H.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:d,error:n,originalError:e}),t.ignoreErrored||j||(j=n),j||(j=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:d,error:e}),t.ignoreErrored||j||(j=e)}}return j?(p("fail"),Promise.reject(j)):(p("idle"),new Promise(function(e){e(g)}))}var S={};function R(t){if(S[t])return S[t].exports;var n=S[t]={i:t,l:!1,exports:{},hot:c(t),parents:(a=s,s=[],a),children:[]};return e[t].call(n.exports,n,n.exports,d(t)),n.l=!0,n.exports}return R.m=e,R.c=S,R.d=function(e,t,n){R.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},R.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},R.t=function(e,t){if(1&t&&(e=R(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(R.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)R.d(n,o,function(t){return e[t]}.bind(null,o));return n},R.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return R.d(t,"a",t),t},R.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},R.p="",R.h=function(){return r},d(8)(R.s=8)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.css=function(e,t){if("object"==typeof t)for(let n in t)e.style[n]=t[n]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cellId=t.rowId=t.TableViewWrapper=t.TableContainer=t.TableBody=t.TableRow=t.TableCell=t.TableCellLine=t.TableColGroup=t.TableCol=void 0;var o,r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,r=!1,l=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw l}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=n(0),i=(o=l)&&o.__esModule?o:{default:o};const s=i.default.import("blots/break"),a=i.default.import("blots/block"),d=i.default.import("blots/container"),c=["width"],u={width:100},h=["row","cell"],p=["rowspan","colspan"],f={rowspan:1,colspan:1},b=5;class m extends a{static create(e){const t=super.create(e);return h.forEach(n=>{let o=`${n}Id`;t.setAttribute(`data-${n}`,e[n]||o())}),p.forEach(n=>{t.setAttribute(`data-${n}`,e[n]||f[n])}),t}static formats(e){return p.concat(h).reduce((t,n)=>(e.hasAttribute(`data-${n}`)&&(t[n]=e.getAttribute(`data-${n}`)||void 0),t),{})}format(e,t){p.concat(h).indexOf(e)>-1?t?this.domNode.setAttribute(`data-${e}`,t):this.domNode.removeAttribute(`data-${e}`):super.format(e,t)}optimize(e){const t=this.domNode.getAttribute("data-row"),n=this.domNode.getAttribute("data-rowspan"),o=parseInt(this.domNode.getAttribute("data-colspan"),10);!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName,{row:t,colspan:o,rowspan:n}),super.optimize(e)}tableCell(){return this.parent}}m.blotName="table-cell-line",m.ClassName="qlbt-cell-line",m.tagName="DIV";class g extends d{checkMerge(){if(super.checkMerge()&&null!=this.next.children.head){const e=this.children.head.formats()["table-cell-line"],t=this.children.tail.formats()["table-cell-line"],n=this.next.children.head.formats()["table-cell-line"],o=this.next.children.tail.formats()["table-cell-line"];return e.cell===t.cell&&e.cell===n.cell&&e.cell===o.cell}return!1}static create(e){const t=super.create(e);return t.setAttribute("data-row",e.row),p.forEach(n=>{e[n]&&t.setAttribute(n,e[n])}),t}static formats(e){const t={};return e.hasAttribute("data-row")&&(t.row=e.getAttribute("data-row")),p.reduce((t,n)=>(e.hasAttribute(n)&&(t[n]=e.getAttribute(n)),t),t)}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}formats(){const e={};return this.domNode.hasAttribute("data-row")&&(e.row=this.domNode.getAttribute("data-row")),p.reduce((e,t)=>(this.domNode.hasAttribute(t)&&(e[t]=this.domNode.getAttribute(t)),e),e)}toggleAttribute(e,t){t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e)}formatChildren(e,t){this.children.forEach(n=>{n.format(e,t)})}format(e,t){p.indexOf(e)>-1?(this.toggleAttribute(e,t),this.formatChildren(e,t)):["row"].indexOf(e)>-1?(this.toggleAttribute(`data-${e}`,t),this.formatChildren(e,t)):super.format(e,t)}optimize(e){const t=this.domNode.getAttribute("data-row");!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName,{row:t}),super.optimize(e)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}g.blotName="table",g.tagName="TD";class y extends d{checkMerge(){if(super.checkMerge()&&null!=this.next.children.head){const e=this.children.head.formats(),t=this.children.tail.formats(),n=this.next.children.head.formats(),o=this.next.children.tail.formats();return e.row===t.row&&e.row===n.row&&e.row===o.row}return!1}static create(e){const t=super.create(e);return t.setAttribute("data-row",e.row),t}formats(){return["row"].reduce((e,t)=>(this.domNode.hasAttribute(`data-${t}`)&&(e[t]=this.domNode.getAttribute(`data-${t}`)),e),{})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}y.blotName="table-row",y.tagName="TR";class w extends d{}w.blotName="table-body",w.tagName="TBODY";class x extends a{static create(e){let t=super.create(e);return c.forEach(n=>{t.setAttribute(`${n}`,e[n]||u[n])}),t}static formats(e){return c.reduce((t,n)=>(e.hasAttribute(`${n}`)&&(t[n]=e.getAttribute(`${n}`)||void 0),t),{})}format(e,t){c.indexOf(e)>-1?this.domNode.setAttribute(`${e}`,t||u[e]):super.format(e,t)}html(){return this.domNode.outerHTML}}x.blotName="table-col",x.tagName="col";class C extends d{}C.blotName="table-col-group",C.tagName="colgroup";class v extends d{static create(){return super.create()}constructor(e,t){super(e,t),this.updateTableWidth()}updateTableWidth(){setTimeout(()=>{const e=this.colGroup();if(!e)return;const t=e.children.reduce((e,t)=>e+=parseInt(t.formats()[x.blotName].width,10),0);this.domNode.style.width=`${t}px`},0)}getSelectedTds(){return this.selectedTds}cells(e){return this.rows().map(t=>t.children.at(e))}colGroup(){return this.children.head}deleteColumns(e,t=[]){var n=this.descendants(w);const o=r(n,1)[0];if(null==o||null==o.children.head)return;const l=this.descendants(g),i=[],s=[];if(l.forEach(t=>{const n=t.domNode.getBoundingClientRect(),o=e.x,r=e.x+e.width,l=n.x,a=n.x+n.width;l+b>o&&a-b<r?i.push(t):l<o+b&&a>r-b&&s.push(t)}),i.length===l.length)return this.tableDestroy(),!0;t.forEach(e=>{this.colGroup().children.at(t[0]).remove()}),i.forEach(e=>{e.remove()}),s.forEach(e=>{const n=parseInt(e.formats().colspan,10);parseInt(e.formats().width,10);e.format("colspan",n-t.length)}),this.updateTableWidth()}deleteRow(e){var t=this.descendants(w);const n=r(t,1)[0];if(null==n||null==n.children.head)return;const o=this.descendants(g),l=[],i=[],s=[];if(o.forEach(t=>{const n=t.domNode.getBoundingClientRect(),o=e.y,r=e.y+e.height,a=n.y,d=n.y+n.height;a>o-b&&d<r+b?l.push(t):a<o+b&&d>r-b&&(i.push(t),Math.abs(a-o)<b&&s.push(t))}),l.length===o.length)return void this.tableDestroy();const a=this.rows().reduce((t,n)=>{let o=n.domNode.getBoundingClientRect();return o.y>e.y-b&&o.y+o.height<e.y+e.height+b&&(t+=1),t},0);s.forEach(e=>{const t=e.domNode.getBoundingClientRect(),n=t.x+t.width,o=e.parent.next,r=o.children.reduce((e,t)=>{const o=t.domNode.getBoundingClientRect();return Math.abs(n-o.x)<b&&(e=t),e},null);o.insertBefore(e,r),e.format("row",o.formats().row)}),l.forEach(e=>{e.remove()}),i.forEach(e=>{const t=parseInt(e.formats().rowspan,10);e.format("rowspan",t-a)})}tableDestroy(){const e=i.default.find(this.scroll.domNode.parentNode),t=e.getModule("better-table");this.remove(),t.hideTableTools(),e.update(i.default.sources.USER)}insertCell(e,t){const n=q(),o=e.formats().row,r=this.scroll.create(g.blotName,Object.assign({},f,{row:o})),l=this.scroll.create(m.blotName,{row:o,cell:n});r.appendChild(l),t?e.insertBefore(r,t):e.appendChild(r)}insertColumn(e,t,n=!0){var o=this.descendants(w);const l=r(o,1)[0];var i=this.descendants(C);const s=r(i,1)[0],a=this.descendants(x);let d=[],c=[],u=[];if(null==l||null==l.children.head)return;this.descendants(g).forEach(t=>{const o=t.domNode.getBoundingClientRect(),r=o.x,l=o.x+o.width,i=e.x,s=e.x+e.width;n?Math.abs(l-s)<b?d.push(t):s-r>b&&s-l<-b&&c.push(t):Math.abs(r-i)<b?d.push(t):i-r>b&&i-l<-b&&c.push(t)}),d.forEach(e=>{const t=n?e.next:e,o=q(),r=e.parent,l=r.formats().row,i=e.formats(),s=this.scroll.create(g.blotName,Object.assign({},f,{row:l,rowspan:i.rowspan})),a=this.scroll.create(m.blotName,{row:l,cell:o,rowspan:i.rowspan});s.appendChild(a),t?r.insertBefore(s,t):r.appendChild(s),u.push(s)});const h=this.scroll.create(x.blotName,!0);let p=n?a[t].next:a[t];return p?s.insertBefore(h,p):s.appendChild(h),c.forEach(e=>{const t=e.formats().colspan;e.format("colspan",parseInt(t,10)+1),u.push(e)}),u.sort((e,t)=>{return e.domNode.getBoundingClientRect().y-t.domNode.getBoundingClientRect().y}),this.updateTableWidth(),u}insertRow(e,t){var n=this.descendants(w);const o=r(n,1)[0];if(null==o||null==o.children.head)return;const l=this.descendants(g),i=T(),a=this.scroll.create(y.blotName,{row:i});let d=[],c=[],u=[];l.forEach(n=>{const o=n.domNode.getBoundingClientRect(),r=e.y,l=e.y+e.height,i=o.y,s=o.y+o.height;t?Math.abs(s-l)<b?d.push(n):l-i>b&&l-s<-b&&c.push(n):Math.abs(i-r)<b?d.push(n):r-i>b&&r-s<-b&&c.push(n)});const h=(e,t)=>{return e.domNode.getBoundingClientRect().x-t.domNode.getBoundingClientRect().x};d.sort(h),d.forEach(e=>{const t=q(),n=e.formats(),o=this.scroll.create(g.blotName,Object.assign({},f,{row:i,colspan:n.colspan})),r=this.scroll.create(m.blotName,{row:i,cell:t,colspan:n.colspan}),l=this.scroll.create(s.blotName);r.appendChild(l),o.appendChild(r),a.appendChild(o),u.push(o)}),c.forEach(e=>{const t=parseInt(e.formats().rowspan,10);e.format("rowspan",t+1),u.push(e)});const p=this.rows().find(n=>{let o=n.domNode.getBoundingClientRect();return t?Math.abs(o.y-e.y-e.height)<b:Math.abs(o.y-e.y)<b});return o.insertBefore(a,p),u.sort(h),u}mergeCells(e,t,n,o){const r=t.reduce((e,t,r)=>(0!==r?(e&&t.moveChildren(e),t.remove()):(t.format("colspan",o),t.format("rowspan",n),e=t),e),null);let l=r.domNode.getAttribute("data-row"),i=r.children.head.domNode.getAttribute("data-cell");return r.children.forEach(e=>{e.format("cell",i),e.format("row",l),e.format("colspan",o),e.format("rowspan",n)}),r}unmergeCells(e){let t={},n=1,o=1;e.forEach(e=>{if(t=e.formats(),n=t.rowspan,(o=t.colspan)>1){let t=e.next,n=e.row();e.format("colspan",1);for(let e=o;e>1;e--)this.insertCell(n,t)}if(n>1){let t=n,r=e.row().next;for(;t>1;){let n=r.children.reduce((t,n)=>{let o=e.domNode.getBoundingClientRect(),r=n.domNode.getBoundingClientRect();return Math.abs(o.x+o.width-r.x)<b&&(t=n),t},null);for(let e=o;e>0;e--)this.insertCell(r,n);t-=1,r=r.next}e.format("rowspan",1)}})}rows(){const e=this.children.tail;return null==e?[]:e.children.map(e=>e)}}v.blotName="table-container",v.className="quill-better-table",v.tagName="TABLE";class N extends d{constructor(e,t){super(e,t);const n=i.default.find(e.domNode.parentNode);t.addEventListener("scroll",e=>{const t=n.getModule("better-table");t.columnTool&&(t.columnTool.domNode.scrollLeft=e.target.scrollLeft)},!1)}}function T(){return`row-${Math.random().toString(36).slice(2,6)}`}function q(){return`cell-${Math.random().toString(36).slice(2,6)}`}N.blotName="table-view",N.className="quill-better-table-wrapper",N.tagName="DIV",N.allowedChildren=[v],v.requiredContainer=N,v.allowedChildren=[w,C],w.requiredContainer=v,w.allowedChildren=[y],y.requiredContainer=w,y.allowedChildren=[g],g.requiredContainer=y,g.allowedChildren=[m],m.requiredContainer=g,C.allowedChildren=[x],C.requiredContainer=v,x.requiredContainer=C,t.TableCol=x,t.TableColGroup=C,t.TableCellLine=m,t.TableCell=g,t.TableRow=y,t.TableBody=w,t.TableContainer=v,t.TableViewWrapper=N,t.rowId=T,t.cellId=q},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,r=!1,l=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,l=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw l}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=d(n(0)),l=d(n(4)),i=d(n(5)),s=d(n(6)),a=n(2);function d(e){return e&&e.__esModule?e:{default:e}}const c=r.default.import("core/module"),u=r.default.import("delta");class h extends c{static register(){r.default.register(a.TableCol,!0),r.default.register(a.TableColGroup,!0),r.default.register(a.TableCellLine,!0),r.default.register(a.TableCell,!0),r.default.register(a.TableRow,!0),r.default.register(a.TableBody,!0),r.default.register(a.TableContainer,!0),r.default.register(a.TableViewWrapper,!0)}constructor(e,t){super(e,t),this.quill.root.addEventListener("click",n=>{if(!n.path||n.path.length<=0)return;const o=n.path.filter(e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("quill-better-table"))[0];if(o){if(this.table===o)return;this.table&&this.hideTableTools(),this.showTableTools(o,e,t)}else this.table&&this.hideTableTools()},!1),this.quill.root.addEventListener("contextmenu",n=>{if(!this.table)return!0;if(n.preventDefault(),!n.path||n.path.length<=0)return;const o=n.path.filter(e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("quill-better-table"))[0],r=n.path.filter(e=>e.tagName&&"TR"===e.tagName.toUpperCase()&&e.getAttribute("data-row"))[0],l=n.path.filter(e=>e.tagName&&"TD"===e.tagName.toUpperCase()&&e.getAttribute("data-row"))[0];let i=this.tableSelection.selectedTds.map(e=>e.domNode).includes(l);(this.tableSelection.selectedTds.length<=0||!i)&&this.tableSelection.setSelection(l.getBoundingClientRect(),l.getBoundingClientRect()),this.tableOperationMenu&&(this.tableOperationMenu=this.tableOperationMenu.destroy()),o&&(this.tableOperationMenu=new s.default({table:o,row:r,cell:l,left:n.pageX,top:n.pageY},e,t.operationMenu))},!1);e.getModule("keyboard");e.keyboard.addBinding({key:"Backspace"},{},function(e,t){if(0===e.index||this.quill.getLength()<=1)return!0;var n=this.quill.getLine(e.index);const r=o(n,1)[0];if(0===t.offset){var l=this.quill.getLine(e.index-1);const t=o(l,1)[0];if(null!=t&&"table-cell-line"===t.statics.blotName&&"table-cell-line"!==r.statics.blotName)return!1}return!0});let n=e.keyboard.bindings.Backspace.pop();e.keyboard.bindings.Backspace.splice(0,1,n)}getTable(e=this.quill.getSelection()){if(null==e)return[null,null,null,-1];var t=this.quill.getLine(e.index),n=o(t,2);const r=n[0],l=n[1];if(null==r||r.statics.blotName!==a.TableCellLine.blotName)return[null,null,null,-1];const i=r.tableCell(),s=i.row();return[s.table(),s,i,l]}insertTable(e,t){const n=this.quill.getSelection(!0);if(null==n)return;this.quill.getLeaf(n.index)[0],this.quill.getLeaf(n.index+1)[0];let o=(new u).retain(n.index);o.insert("\n"),o=new Array(t).fill("\n").reduce((e,t)=>(e.insert(t,{"table-col":!0}),e),o),o=new Array(e).fill(0).reduce(e=>{let n=(0,a.rowId)();return new Array(t).fill("\n").reduce((e,t)=>(e.insert(t,{"table-cell-line":{row:n,cell:(0,a.cellId)()}}),e),e)},o),this.quill.updateContents(o,r.default.sources.USER),this.quill.setSelection(n.index+1,r.default.sources.SILENT)}showTableTools(e,t,n){this.table=e,this.columnTool=new l.default(e,t,n),this.tableSelection=new i.default(e,t,n)}hideTableTools(){this.columnTool.destroy(),this.tableSelection.destroy(),this.tableOperationMenu&&this.tableOperationMenu.destroy(),this.columnTool=null,this.tableSelection=null,this.tableOperationMenu=null,this.table=null}}h.keyboardBindings={"table-cell-line backspace":{key:"Backspace",format:["table-cell-line"],collapsed:!0,offset:0,handler(e,t){var n=this.quill.getLine(e.index),r=o(n,2);const l=r[0];r[1];return!(!l.prev||"table-cell-line"!==l.prev.statics.blotName)}},"table-cell-line delete":{key:"Delete",format:["table-cell-line"],collapsed:!0,suffix:/^$/,handler(){}},"table-cell-line enter":{key:"Enter",shiftKey:null,format:["table-cell-line"],handler(e,t){if(this.quill.selection&&this.quill.selection.composing)return;const n=r.default.imports.parchment.Scope;e.length>0&&this.quill.scroll.deleteAt(e.index,e.length);const o=Object.keys(t.format).reduce((e,o)=>(this.quill.scroll.query(o,n.BLOCK)&&!Array.isArray(t.format[o])&&(e[o]=t.format[o]),e),{});this.quill.insertText(e.index,"\n",o["table-cell-line"],r.default.sources.USER),this.quill.setSelection(e.index+1,r.default.sources.SILENT),this.quill.focus(),Object.keys(t.format).forEach(e=>{null==o[e]&&(Array.isArray(t.format[e])||"link"!==e&&this.quill.format(e,t.format[e],r.default.sources.USER))})}}},t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(0),l=(o=r)&&o.__esModule?o:{default:o},i=n(1);const s=12,a=12,d=50,c="#35A7ED";t.default=class{constructor(e,t,n){if(!e)return null;this.table=e,this.quill=t,this.options=n,this.domNode=null,this.initColTool()}initColTool(){const e=this.quill.root.parentNode,t=(this.table.getBoundingClientRect(),e.getBoundingClientRect()),n=this.table.parentNode.getBoundingClientRect();this.domNode=document.createElement("div"),this.domNode.classList.add("qlbt-col-tool"),this.updateToolCells(),e.appendChild(this.domNode),(0,i.css)(this.domNode,{width:`${n.width}px`,height:`${s}px`,left:`${n.left-t.left+e.scrollLeft}px`,top:`${n.top-t.top+e.scrollTop-s-5}px`})}createToolCell(){const e=document.createElement("div");e.classList.add("qlbt-col-tool-cell");const t=document.createElement("div");return t.classList.add("qlbt-col-tool-cell-holder"),(0,i.css)(e,{height:`${a}px`}),e.appendChild(t),e}updateToolCells(){const e=l.default.find(this.table),t=e.children.tail.children.head.children,n=e.colGroup().children,o=function(e){return e.reduce((e,t)=>{const n=t.formats().colspan;return e+=parseInt(n,10)},0)}(t);let r=Array.from(this.domNode.querySelectorAll(".qlbt-col-tool-cell"));for(let e=0;e<Math.max(o,r.length);e++){let t=n.at(e),l=t&&parseInt(t.formats()[t.statics.blotName].width,10),s=null;r[e]?r[e]&&e>=o?r[e].remove():(s=r[e],(0,i.css)(s,{"min-width":`${l}px`})):(s=this.createToolCell(),this.domNode.appendChild(s),this.addColCellHolderHandler(s),(0,i.css)(s,{"min-width":`${l}px`}))}}destroy(){return this.domNode.remove(),null}addColCellHolderHandler(e){const t=l.default.find(this.table),n=e.querySelector(".qlbt-col-tool-cell-holder");let o=!1,r=0,a=0,u=0,h=0,p={},f={},b=null;const m=e=>{e.preventDefault(),o&&(a=e.clientX,u=h+a-r>=d?a-r:d-h,(0,i.css)(b,{left:`${f.left+f.width-1+u}px`}))},g=l=>{l.preventDefault();const s=Array.from(this.domNode.querySelectorAll(".qlbt-col-tool-cell")).indexOf(e),d=t.colGroup().children.at(s);o&&(d.format("width",h+u),(0,i.css)(e,{"min-width":`${h+u}px`}),r=0,a=0,u=0,h=0,o=!1,n.classList.remove("dragging")),document.removeEventListener("mousemove",m,!1),document.removeEventListener("mouseup",g,!1),p={},f={},b.remove(),b=null,t.updateTableWidth();const c=this.quill.getModule("better-table").tableSelection;c&&c.clearSelection()};n.addEventListener("mousedown",t=>{document.addEventListener("mousemove",m,!1),document.addEventListener("mouseup",g,!1),p=this.table.getBoundingClientRect(),f=e.getBoundingClientRect(),b=document.createElement("div"),(0,i.css)(b,{position:"fixed",top:`${f.top}px`,left:`${f.left+f.width-1}px`,zIndex:"100",height:`${p.height+s+4}px`,width:"1px",backgroundColor:c}),document.body.appendChild(b),o=!0,r=t.clientX,h=f.width,n.classList.add("dragging")},!1)}colToolCells(){return Array.from(this.domNode.querySelectorAll(".qlbt-col-tool-cell"))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(0),l=(o=r)&&o.__esModule?o:{default:o},i=n(1),s=n(2);const a="#35A7ED",d=["left","right","top","bottom"],c=2;function u(e,t){let n=Math.min(e.x,t.x,e.x+e.width-1,t.x+t.width-1),o=Math.max(e.x,t.x,e.x+e.width-1,t.x+t.width-1),r=Math.min(e.y,t.y,e.y+e.height-1,t.y+t.height-1),l=Math.max(e.y,t.y,e.y+e.height-1,t.y+t.height-1);return{x:n,x1:o,y:r,y1:l,width:o-n,height:l-r}}t.default=class{constructor(e,t,n){if(!e)return null;this.table=e,this.quill=t,this.options=n,this.boundary={},this.selectedTds=[],this.dragging=!1,this.selectingHandler=this.mouseDownHandler.bind(this),this.clearSelectionHanler=this.clearSelection.bind(this),this.helpLinesInitial(),this.quill.root.addEventListener("mousedown",this.selectingHandler,!1),this.quill.on("text-change",this.clearSelectionHanler)}helpLinesInitial(){let e=this.quill.root.parentNode;d.forEach(t=>{this[t]=document.createElement("div"),this[t].classList.add("qlbt-selection-line"),(0,i.css)(this[t],{position:"absolute",display:"none","background-color":a}),e.appendChild(this[t])})}mouseDownHandler(e){if(0!==e.button||!e.target.closest(".quill-better-table"))return;this.quill.root.addEventListener("mousemove",r,!1),this.quill.root.addEventListener("mouseup",function e(n){t.quill.root.removeEventListener("mousemove",r,!1),t.quill.root.removeEventListener("mouseup",e,!1),t.dragging=!1},!1);const t=this,n=e.target.closest("td[data-row]"),o=n.getBoundingClientRect();function r(e){if(0!==e.button||!e.target.closest(".quill-better-table"))return;const r=e.target.closest("td[data-row]"),l=r.getBoundingClientRect();t.boundary=u(o,l),t.correctBoundary(),t.selectedTds=t.computeSelectedTds(),t.repositionHelpLines(),n!==r&&t.quill.blur()}this.dragging=!0,this.boundary=u(o,o),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(),this.repositionHelpLines()}correctBoundary(){l.default.find(this.table).descendants(s.TableCell).forEach(e=>{var t=e.domNode.getBoundingClientRect();let n=t.x,o=t.y,r=t.width,l=t.height;(n+c>=this.boundary.x&&n+c<=this.boundary.x1||n-c+r>=this.boundary.x&&n-c+r<=this.boundary.x1)&&(o+c>=this.boundary.y&&o+c<=this.boundary.y1||o-c+l>=this.boundary.y&&o-c+l<=this.boundary.y1)&&(this.boundary=u(this.boundary,{x:n,y:o,width:r,height:l}))})}computeSelectedTds(){return l.default.find(this.table).descendants(s.TableCell).reduce((e,t)=>{var n=t.domNode.getBoundingClientRect();let o=n.x,r=n.y,l=n.width,i=n.height;return o+c>=this.boundary.x&&o-c+l<=this.boundary.x1&&r+c>=this.boundary.y&&r-c+i<=this.boundary.y1&&e.push(t),e},[])}repositionHelpLines(){const e=this.quill.root.parentNode.getBoundingClientRect();(0,i.css)(this.left,{display:"block",left:`${this.boundary.x-e.x-1}px`,top:`${this.boundary.y-e.y}px`,height:`${this.boundary.y1-this.boundary.y+1}px`,width:"1px"}),(0,i.css)(this.right,{display:"block",left:`${this.boundary.x1-e.x}px`,top:`${this.boundary.y-e.y}px`,height:`${this.boundary.y1-this.boundary.y+1}px`,width:"1px"}),(0,i.css)(this.top,{display:"block",left:`${this.boundary.x-e.x-1}px`,top:`${this.boundary.y-e.y}px`,width:`${this.boundary.x1-this.boundary.x+1}px`,height:"1px"}),(0,i.css)(this.bottom,{display:"block",left:`${this.boundary.x-e.x-1}px`,top:`${this.boundary.y1-e.y+1}px`,width:`${this.boundary.x1-this.boundary.x+1}px`,height:"1px"})}refreshHelpLinesPosition(){this.selectedTds[0].domNode.getBoundingClientRect();const e=this.selectedTds[this.selectedTds.length-1].domNode.getBoundingClientRect();this.boundary=u(startTdRect,e),this.repositionHelpLines()}destroy(){return d.forEach(e=>{this[e].remove(),this[e]=null}),this.quill.root.removeEventListener("mousedown",this.selectingHandler,!1),this.quill.off("text-change",this.clearSelectionHanler),null}setSelection(e,t){this.boundary=u(e,t),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(),this.repositionHelpLines()}clearSelection(){this.boundary={},this.selectedTds=[],d.forEach(e=>{this[e]&&(0,i.css)(this[e],{display:"none"})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(0),l=(o=r)&&o.__esModule?o:{default:o},i=n(1);const s=150,a=200,d={insertColumnRight:{text:"Insert column right",handler(){const e=l.default.find(this.table);let t=c(this.columnToolCells,this.boundary,(e,t)=>Math.abs(e.x+e.width-t.x1)<=3);const n=e.insertColumn(this.boundary,t,!0);this.tableColumnTool.updateToolCells(),this.quill.update(l.default.sources.USER),this.quill.setSelection(this.quill.getIndex(n[0]),0,l.default.sources.SILENT),this.tableSelection.setSelection(n[0].domNode.getBoundingClientRect(),n[0].domNode.getBoundingClientRect())}},insertColumnLeft:{text:"Insert column left",handler(){const e=l.default.find(this.table);let t=c(this.columnToolCells,this.boundary,(e,t)=>Math.abs(e.x-t.x)<=3);const n=e.insertColumn(this.boundary,t,!1);this.tableColumnTool.updateToolCells(),this.quill.update(l.default.sources.USER),this.quill.setSelection(this.quill.getIndex(n[0]),0,l.default.sources.SILENT),this.tableSelection.setSelection(n[0].domNode.getBoundingClientRect(),n[0].domNode.getBoundingClientRect())}},insertRowUp:{text:"Insert row up",handler(){const e=l.default.find(this.table).insertRow(this.boundary,!1);this.quill.update(l.default.sources.USER),this.quill.setSelection(this.quill.getIndex(e[0]),0,l.default.sources.SILENT),this.tableSelection.setSelection(e[0].domNode.getBoundingClientRect(),e[0].domNode.getBoundingClientRect())}},insertRowDown:{text:"Insert row down",handler(){const e=l.default.find(this.table).insertRow(this.boundary,!0);this.quill.update(l.default.sources.USER),this.quill.setSelection(this.quill.getIndex(e[0]),0,l.default.sources.SILENT),this.tableSelection.setSelection(e[0].domNode.getBoundingClientRect(),e[0].domNode.getBoundingClientRect())}},mergeCells:{text:"Merge selected cells",handler(){const e=l.default.find(this.table),t=e.rows().reduce((e,t)=>{let n=t.domNode.getBoundingClientRect();return n.y>this.boundary.y-3&&n.y+n.height<this.boundary.y+this.boundary.height+3&&(e+=1),e},0),n=this.columnToolCells.reduce((e,t)=>{let n=t.getBoundingClientRect();return n.x>this.boundary.x-3&&n.x+n.width<this.boundary.x+this.boundary.width+3&&(e+=1),e},0),o=e.mergeCells(this.boundary,this.selectedTds,t,n);this.quill.update(l.default.sources.USER),this.tableSelection.setSelection(o.domNode.getBoundingClientRect(),o.domNode.getBoundingClientRect())}},unmergeCells:{text:"Unmerge cells",handler(){l.default.find(this.table).unmergeCells(this.selectedTds),this.quill.update(l.default.sources.USER),this.tableSelection.clearSelection()}},deleteColumn:{text:"Delete selected columns",handler(){const e=l.default.find(this.table);let t=(n=this.columnToolCells,o=this.boundary,r=((e,t)=>e.x+3>t.x&&e.x+e.width-3<t.x1),n.reduce((e,t)=>{let l=t.getBoundingClientRect();return r(l,o)&&e.push(n.indexOf(t)),e},[]));var n,o,r;e.deleteColumns(this.boundary,t)||(this.tableColumnTool.updateToolCells(),this.quill.update(l.default.sources.USER),this.tableSelection.clearSelection())}},deleteRow:{text:"Delete selected rows",handler(){l.default.find(this.table).deleteRow(this.boundary),this.quill.update(l.default.sources.USER),this.tableSelection.clearSelection()}},deleteTable:{text:"Delete table",handler(){const e=this.quill.getModule("better-table"),t=l.default.find(this.table);e.hideTableTools(),t.remove(),this.quill.update(l.default.sources.USER)}}};function c(e,t,n){return e.reduce((o,r)=>{let l=r.getBoundingClientRect();return n(l,t)&&(o=e.indexOf(r)),o},!1)}t.default=class{constructor(e,t,n){const o=t.getModule("better-table");this.tableSelection=o.tableSelection,this.table=e.table,this.quill=t,this.options=n,this.menuItems=Object.assign({},d,n.items),this.tableColumnTool=o.columnTool,this.boundary=this.tableSelection.boundary,this.selectedTds=this.tableSelection.selectedTds,this.destroyHanlder=this.destroy.bind(this),this.columnToolCells=this.tableColumnTool.colToolCells(),this.menuInitial(e),this.mount(),document.addEventListener("click",this.destroyHanlder,!1)}mount(){document.body.appendChild(this.domNode)}destroy(){return this.domNode.remove(),document.removeEventListener("click",this.destroyHanlder,!1),null}menuInitial({table:e,left:t,top:n}){this.domNode=document.createElement("div"),this.domNode.classList.add("qlbt-operation-menu"),(0,i.css)(this.domNode,{position:"absolute",left:`${t}px`,top:`${n}px`,"min-height":`${s}px`,width:`${a}px`});for(let e in this.menuItems)this.menuItems[e]&&this.domNode.appendChild(this.menuItemCreator(Object.assign({},d[e],this.menuItems[e])))}menuItemCreator({text:e,handler:t}){const n=document.createElement("div");return n.classList.add("qlbt-operation-menu-item"),n.innerText=e,n.addEventListener("click",t.bind(this),!1),n}}},,function(e,t,n){e.exports=n(3)}]).default});